0. Ansible:

```bash
ansible --version
ansible-config dump | grep -E "modules?" | head -n1
echo $(ansible-doc --list | wc -l) >> modules # Or: `ansible-doc -l | wc -l > /root/modules`
ansible-doc --snippet setup # Read the snippet (-s) document about given task's name.
ansible-doc --snippet copy

ansible servers -i /root/hosts -m ping # NOTE: Only working with .ini config file's format
# Exp:
# controlplane $ cat hosts
# [servers]
# controlplane
# node01

# Fix done:
# servers:
#   hosts:
#     controlplane:
#     node01:

# NOTE: `setup` was a builtin module/plugin from the Ansible ecosystem (like: `ping`, `shell`, etc),
# that can be used directly to retrieve configuration from an custom inventory.
ansible servers -i /root/hosts -m setup > version
```

```ini
[atlanta]
host1
host2

[atlanta:vars]
ntp_server=ntp.atlanta.example.com
proxy=proxy.atlanta.example.com
```

```yml
atlanta:
  hosts:
    host1:
    host2:
  vars:
    ntp_server: ntp.atlanta.example.com
    proxy: proxy.atlanta.example.com
```

```bash
# Pattern: `ansible <pattern> -m <module_name> -a "<module options>"`
# Link: https://docs.ansible.com/ansible/latest/inventory_guide/intro_patterns.html#intro-patterns
#
# `-a MODULE_ARGS, --args MODULE_ARGS`
ansible servers -i /root/hosts.yml -m shell -a "uptime"
ansible servers -i /root/hosts.yml -m shell -a "uname -s"
ansible servers -i /root/hosts.yml -m shell -a "date" > date

# NOTE: `ansible-doc -s setup` --> setup's arguments := {setup's yaml properties := [fact_path, filter, gather_subnet, gather_timeout]}.
ansible servers -i hosts -m setup | grep -iE "^.*"distribution".*"
ansible servers -i hosts -m setup -a "filter=ansible_distribution" > version

ansible servers -i hosts -m setup | grep -iE "^.*"date".*"
ansible servers -i hosts -m setup -a "filter=ansible_date_time" > date

cp ./{hosts,configfile.cfg} /opt/deployment
cp ./{hosts{1,2},configfile.cfg} /opt/deployment # Braces expansion.

sed -i -E "s/0{6}/1{6}/g" configfile.cfg # Transform: `000000 -> 1{6}`
sed -i -E "s/0{6}/111111/g" configfile.cfg # Guess: only detect the presented pattern, not apply with the changes itself.

# Create files/dirs:
ansible servers -i hosts -m file -a "path=/opt/deployment state=directory" # `-vvv`: for debugging mode.
# Copy file to destination directory:
ansible servers -i hosts -m copy -a "src=/root/configfile.cfg dest=/opt/deployment"
# Update content from a specific line (if present in file):
ansible servers -i hosts -m lineinfile -a "path=/opt/deployment/configfile.cfg regexp='^var1' line='var1=11111'"
ansible servers -i hosts -m lineinfile -a "path=/opt/deployment/configfile.cfg regexp='^.*1{6}' line='dude'"
```

```out
controlplane $ cat .wget-hsts
# HSTS 1.0 Known Hosts database for GNU Wget.
# Edit at your own risk.
# <hostname>    <port>  <incl. subdomains>      <created>       <max-age>
github.com
```

- NOTE: A simple playbook example:

```out
# My method:

controlplane $ ansible-lint deploy.yml
controlplane $ cat deploy.yml
---

- name: Push the gun-zipped file tar.gz over to all servers.
  hosts: servers
  remote_user: root

  tasks:
    - name: Push file deploy.tar.gz
      ansible.builtin.copy:
        src: /root/deploy.tar.gz
        dest: /opt

controlplane $ ansible-playbook -i hosts deploy.yml -f 10 -v
# `-f N` := forks N times.
# `-v` := verbose output mode.
```

```out
# Author's method:

controlplane $ sha1sum /root/deploy.tar.gz
c6cd21b75a4b300b9228498c78afc6e7a831839e  /root/deploy.tar.gz

controlplane $ cat deploy.yml
---

- name: Start of Deployer playbook
  hosts: servers
  vars:
  gather_facts: True
  become: False

  tasks:
    - name: Copy deploy.tar.gz over at {{ ansible_date_time.iso8601_basic_short }}
      copy:
        src: /root/deploy.tar.gz
        dest: /opt/deploy.tar.gz
        checksum: c6cd21b75a4b300b9228498c78afc6e7a831839e

controlplane $ ansible servers -i /root/hosts -m shell -a 'ls -l /opt/deploy.tar.gz'
```

```bash
# NOTE: A complete example:
# Always quote template expression brackets when they start a value. For instance:
#    with_items:
#      - {{ foo }}
#
# Should be written as:
#    with_items:
#      - "{{ foo }}"
```

```yml
# Not working properly yet!
---
- name: Deployment zipped file playbook.
  hosts: servers
  vars:
    file_name: /deploy.tar.gz
    file_path: "/root/{{ file_name }}"
  gather_facts: True
  become: False

  tasks:
    - name: Getting the SHA-1 checksum.
      # `ansible.builtin.shell` != `shell` (`shell`: execute existed binary libraries on the host machine.)
      ansible.builtin.shell: |
        /usr/bin/sha1sum "{{ file_path }}" | cut -d ' ' -f1
      register: hash_val

    - name: Binding fact to Ansible's var.
      ansible.builtin.set_fact:
        hash_var: "{{ hash_val.stdout }}"

    - name: Pushing to all hosts from "{{ file_path | b64encode }}" at "{{ ansible_date_time.date }}"
      ansible.builtin.copy:
        src: "{{ file_path }}"
        dest: "/opt/{{ file_name }}"
        checksum: "{{ hash_val }}"
```

````yml
# .ini configuration hosts file:
# ```ini
# [servers]
# controlplane
# node 01
# ```

# Working perfectly fine!
---
- name: Test retrieve checksum from file
  hosts: servers
  vars:
    file_name: "deploy.tar.gz"
    app_path: "/opt/app"
  gather_facts: True
  become: False

  tasks:
    - name: Testing task.
      shell: |
        /usr/bin/sha1sum "{{ file_name }}" | cut -d ' ' -f1
      register: test

    - name: Binding variables.
      set_fact:
        hash_var: "{{ test.stdout }}"

    - name: Publishing gun-zipped file at "{{ ansible_date_time.date | b64encode }}"
      copy:
        src: "/root/{{ file_name }}"
        dest: "/opt/{{ file_name }}"
        # FIX: Cannot use `{{ test }}`  here because of the stdout in Ansible (Python) was too large!
        checksum: "{{ hash_var }}"

    - name: Create directory to store unarchive's files.
      file:
        path: "{{ app_path }}"
        state: directory

    - name: Unarchive using builtin module.
      unarchive:
        src: "/opt/{{ file_name }}"
        dest: "{{ app_path }}"

    - name: Make installer script becoming executable.
      file:
        path: "{{ app_path }}/deploy/deployer.sh"
        mode: 0755

    - name: Running installer script.
      shell: "{{ app_path }}/deploy/deployer.sh"
      register: installer_stdout

    - name: Debug and show installer_stdout.
      debug:
        var: installer_stdout

    - name: Unpacked file /opt/"{{ file_name }}"
      shell: |
        tar xvzf "/opt/{{ file_name }}" && \
          find /opt -type f -iname "*.sh"
        if [[ $? == 0 ]]; then sh deployer.sh; fi
````

# Testing result:

ansible servers -i hosts -m shell -a "ls -lR /opt/app; cat /opt/app//deploy/deployer.sh"

```yml
# Shared variables between each hosts.
---
- hosts: master01
  tasks:
    - name: Print the value
      shell: |
        echo "hi"
      register: some_variable_name

    - name: Set fact
      set_fact:
        my_var: "{{ some_variable_name.stdout }}"

- hosts: kube-minions
  tasks:
    - name: Print the variable
      shell: |
        echo "{{ hostvars['master01'].my_var }}"
```

```out
"cmd": [
  "/usr/bin/tar",
  "--extract",
  "-C",
  "/opt/app",
  "-z",
  "-f",
  "/root/.ansible/tmp/ansible-tmp-1672629865.7619288-102645114785870/source"
],
```

```yml
# NOTE: Truly final worthy form.
---
- name: Test deployment archive file.
  hosts: servers
  vars:
    - host_file: "hosts"
    - file_name: "deploy.tar.gz"
    - src_dir: "/root"
    - dest_dir: "/opt"
  gather_facts: True
  become: False

  tasks:
    - name: Verify host file.
      shell: cat "{{ src_dir }}/{{ host_file }}"
      register: list_host
      ignore_errors: True

    - name: Print out hosts.
      debug:
        # NOTE: Both syntax were accepted.
        # `var: list_hosts.stdout_lines`.
        var: "{{ list_host.stdout_lines }}"

    - name: Gathering checksum fact.
      shell: sha1sum "{{ src_dir }}/{{ file_name }}" | cut -d ' ' -f1
      register: checksum

    - name: Binding checksum to Ansible's variable.
      set_fact:
        hash_var: "{{ checksum.stdout }}"

    - name: Publish deployment script to all hosts.
      copy:
        src: "{{ src_dir }}/{{ file_name }}"
        dest: "{{ dest_dir }}/{{ file_name }}"
        checksum: "{{ hash_var }}"

    - name: Create installer directory.
      file:
        path: "{{ dest_dir }}/app"
        state: directory

    - name: Unarchive deployment target file.
      unarchive:
        src: "{{ dest_dir }}/{{ file_name }}"
        dest: "{{ dest_dir }}/app"

    - name: Running installer script.
      file:
        path: "{{ dest_dir }}/app/deploy/deployer.sh"
        mode: 0755

    - name: Execute installer script.
      shell: "{{ dest_dir }}/app/deploy/deployer.sh"
      register: installer_stdout

    - name: Debugger to show script's stdout.
      debug:
        var: installer_stdout
```
